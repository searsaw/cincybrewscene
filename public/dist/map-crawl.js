"use strict";$(document).ready(function(){function e(e){e.forEach(function(e){console.log(e.attributes.Text),$("#directions").append('<p><i class="fa fa-car"></i> '+e.attributes.Text+"</p>")})}function t(e){return{geometry:{x:e.loc[0],y:e.loc[1]},attributes:{Name:e.name}}}function a(e){return{features:e.map(t)}}function n(e){return{geometry:{x:e.loc[0],y:e.loc[1]},attributes:{Name:e.name}}}function o(e){return{features:e.map(n)}}function r(e,t){return{attributes:{Name:"Route "+(t+1),StartDepotName:e.name,EarliestStartTime:14556096e5,LatestStartTime:14556096e5}}}function i(e){return{features:e.map(r)}}function c(e){var t=e.value.features;t.forEach(function(e){var a=t[0].geometry.paths[0].map(function(e){return L.latLng(e[1],e[0])}),n=L.polyline(a);b.addLayer(n)}),$(".loader").hide()}function s(e){return function(t){var a=t.value.features.slice().sort(function(e,t){return e.attributes.Sequence-t.attributes.Sequence}).map(function(e){return e.attributes.Name}).map(function(t){return e.find(function(e){return e.name===t})}).filter(Boolean);p(a)}}function u(t){e(t.value.features)}function l(e,t,n,r){var l="https://logistics.arcgis.com/arcgis/rest/services/World/VehicleRoutingProblem/GPServer/SolveVehicleRoutingProblem",d=r,p=n.slice(0,1),f=n.slice(1),m=new e(l+"?token="+d),g={default_date:14556096e5,time_units:"Minutes",distance_units:"Miles",depots:JSON.stringify(a(p)),orders:JSON.stringify(o(f)),routes:JSON.stringify(i(p)),populate_directions:!0};m.submitJob(g).then(function(e){m.getResultData(e.jobId,"out_routes").then(c),m.getResultData(e.jobId,"out_stops").then(s(n)),m.getResultData(e.jobId,"out_directions").then(u)})}function d(e,t){var a=$("input").val();$.ajax({url:"/api/crawls/breweries/"+a,success:function(a){a=a,w(a),$.ajax({url:"/api/token",success:function(n){console.log(a.breweries),l(e,t,a.breweries,n)}})}})}function p(e){e.forEach(function(e){$(".allBreweries .brews").append("\n        <div class='brew' data-long=\""+e.loc[0]+'" data-lat="'+e.loc[1]+'">\n          <img src="'+e.logo+'" />\n          <h3>'+e.name+"</h3>\n        </div>\n        ")})}function f(){var e=$(".allBreweries");e.removeClass("active"),e.css("right","-260px")}var m=null,g=null,b=L.map("map").setView([39.13,-84.5167],12);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"jakeboyles.j0ajipap",accessToken:"pk.eyJ1IjoiamFrZWJveWxlcyIsImEiOiJNcGJpWXhJIn0.ONDjoScLnbU4_VVfXmeIAA"}).addTo(b);var h=new L.FeatureGroup,v={keepSpiderfied:!0},y=new OverlappingMarkerSpiderfier(b,v),k=new L.Popup;y.addListener("click",function(e){k.setContent(e.desc),k.setLatLng(e.getLatLng()),b.openPopup(k)});var h=new L.FeatureGroup,w=function(e){e=e.breweries,e.forEach(function(e){var t=new L.LatLng(e.loc[1],e.loc[0]),a=L.icon({iconUrl:e.logo,iconSize:[45,55],shadowSize:[50,64],iconAnchor:[22,54],shadowAnchor:[4,62],popupAnchor:[-3,-86]}),n=new L.Marker(t,{icon:a});n.desc="\n    <b>"+e.name+"</b>\n    <p class='content'>\n    <i class=\"fa fa-home\"></i> "+e.address+'<br>\n    <i class="fa fa-phone"></i> '+e.phone+'<br>\n    <img\n      width="40"\n      height="40"\n      class="uber-link"\n      src="/images/uber.png"\n      data-latitude="'+e.loc[1]+'"\n      data-longitude="'+e.loc[0]+'"\n      data-name="'+e.name+'"\n      data-address="'+e.address+", "+e.city+", "+e.state+" "+e.zip+'"\n    />\n    </p>',h.addLayer(n),y.addMarker(n)}),b.addLayer(h)};if($("body").on("click",".uber-link",function(){var e=$(this),t=e.data("latitude"),a=e.data("longitude"),n=e.data("name"),o=e.data("address"),r="https://m.uber.com/ul?client_id=gY6iGb3XfnCI35tZ968HvPWA1rmgBSK1&action=setPickup&pickup[latitude]="+m+"&pickup[longitude]="+g+"&pickup[nickname]=Current%20Location&dropoff[latitude]="+t+"&dropoff[longitude]="+a+"&dropoff[nickname]="+encodeURIComponent(n)+"&dropoff[formatted_address]="+encodeURIComponent(o)+"&product_id=68cddf62-ea57-4cdf-9c63-dfbfebfd7095";window.location=r}),$("body").on("click",".brew",function(){var e=$(this),t=e.data("long"),a=e.data("lat"),n=L.latLng(a,t);b.setView(n,14),f()}),$(".flyout").on("click",function(){var e=$(this).parent();e.toggleClass("active"),e.hasClass("active")?e.css("right","0px"):e.css("right","-260px")}),"geolocation"in navigator){var S=null;navigator.geolocation.watchPosition(function(e){S&&(h.removeLayer(S),y.removeMarker(S));var t=e.coords;m=t.latitude,g=t.longitude;var a=L.latLng(m,g);S=new L.Marker(a),h.addLayer(S),y.addMarker(S)})}var x=["esri/tasks/Geoprocessor","esri/geometry/Point"];require(x,d)});